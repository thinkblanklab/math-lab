<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ˆë“± ë¬´í•œ ì—°ì‚° ìƒì„±ê¸°</title>
    <style>

        /* [ê³µí†µ ìŠ¤íƒ€ì¼] */
        body { font-family: 'Malgun Gothic', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        
        .control-panel { 
            max-width: 1000px; margin: 0 auto; background: white; padding: 30px; 
            border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
            width: 95%; 
            text-align: center;
        }
        h1 { margin-bottom: 10px; color: #333; }
        .subtitle { color: #666; font-size: 0.9em; margin-bottom: 20px; }

        .search-box {
            width: 80%; padding: 12px; font-size: 1.1em; border: 2px solid #007bff; border-radius: 30px;
            margin-bottom: 20px; outline: none; text-align: center;
        }
        
        .tabs { display: flex; justify-content: center; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab-btn { padding: 10px 20px; border: none; background: none; cursor: pointer; font-size: 1.2em; font-weight: bold; color: #888; transition: 0.3s; }
        .tab-btn.active { color: #007bff; border-bottom: 3px solid #007bff; }

        .options { display: none; padding: 10px; background: #fff; text-align: left; }
        .options.active { display: block; }

        details { margin-bottom: 15px; background: #f9f9f9; border-radius: 10px; overflow: hidden; border: 1px solid #eee; }
        summary {
            padding: 15px; cursor: pointer; font-weight: bold; font-size: 1.1em; color: #444;
            background: #f1f3f5; list-style: none; display: flex; justify-content: space-between; align-items: center;
        }
        summary::-webkit-details-marker { display: none; }
        summary::after { content: 'â–¼'; font-size: 0.8em; color: #888; transition: 0.3s; }
        details[open] summary::after { transform: rotate(180deg); }
        
        .opt-content { padding: 20px; }
        .sub-category {
            font-size: 1.05em; font-weight: bold; color: #007bff; 
            margin-top: 20px; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 2px solid #e9ecef;
        }
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 10px; }
        .checkbox-group label { cursor: pointer; font-size: 0.95em; display: flex; align-items: center; gap: 8px; color: #555; }
        .checkbox-group label:hover { color: #000; background: #eef; border-radius: 5px; }
        .v-label { color: #0056b3; font-weight: bold; background: #e7f1ff; padding: 2px 6px; border-radius: 4px; font-size: 0.85em; margin-left: 5px; }

        .bottom-controls {
            margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee;
            display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap;
        }
        .ctrl-group { display: flex; flex-direction: column; text-align: left; }
        .ctrl-label { font-size: 0.9em; font-weight: bold; margin-bottom: 5px; color: #555; }
        select { padding: 10px; font-size: 1.1em; border-radius: 5px; border: 1px solid #ccc; min-width: 150px; }
        #difficulty.diff-easy { border-color: #28a745; color: #28a745; }
        #difficulty.diff-hard { border-color: #dc3545; color: #dc3545; }

        button.print-btn { background-color: #007bff; color: white; border: none; padding: 15px 50px; font-size: 1.3em; border-radius: 50px; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        button.print-btn:hover { background-color: #0056b3; transform: translateY(-2px); }

        #print-area { display: none; }

        @media print {
            body { background: white; margin: 0; padding: 0; }
            .control-panel { display: none !important; } 
            #print-area { display: block !important; }
            @page { margin: 10mm 15mm; size: A4 portrait; }

            .page { width: 100%; height: 100vh; page-break-after: always; position: relative; box-sizing: border-box; padding-top: 0; }
            .page:last-child { page-break-after: auto; }

            .paper-header { border-bottom: 2px solid #333; padding-bottom: 5px; margin-bottom: 10px; text-align: center; padding-top: 5px; }
            .paper-title { font-size: 20pt; font-weight: bold; margin-bottom: 5px; }
            .paper-info { display: flex; justify-content: space-between; font-size: 10pt; color: #333; font-weight: bold; }
            .simple-header { text-align: right; border-bottom: 1px dashed #ccc; margin-bottom: 10px; padding-bottom: 5px; color: #888; font-size: 9pt; padding-top: 10px; }

            /* êµ¬ì—­ë³„ ê·¸ë¦¬ë“œ (ê°„ê²© ì¡°ì •) */
            .section-grid-4 { 
                display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px 10px; margin-bottom: 15px;
            }
            .section-grid-2 { 
                display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px 20px; margin-bottom: 15px;
            }
            
            .problem-item { box-sizing: border-box; padding: 5px 5px; border-bottom: 1px dashed #eee; display: flex; page-break-inside: avoid; }
            
            /* [V46 ìˆ˜ì •] ë†’ì´ë¥¼ ì¡°ê¸ˆ ë” ë„‰ë„‰í•˜ê²Œ í‚¤ì›€ */
            
            /* ê°€ë¡œì…ˆ: 60px -> 80px */
            .problem-item.type-h { 
                min-height: 80px; 
                align-items: center; 
            }
            .problem-text-h { font-family: 'Courier New', monospace; font-weight: bold; font-size: 18pt; margin-left: 5px; margin-top: 5px; }

            /* ì¼ë°˜ ì„¸ë¡œì…ˆ: 120px -> 150px */
            .problem-item.type-v { 
                min-height: 150px; 
                align-items: flex-start; 
                padding-top: 15px; 
            }
            .problem-text-v { 
                font-family: 'Courier New', monospace; font-weight: bold; font-size: 20pt; 
                text-align: right; display: flex; flex-direction: column; align-items: flex-end; 
                margin-left: 5px; width: auto;
            }
            
            /* ì„¸ë¡œ ë‚˜ëˆ—ì…ˆ: 200px -> 230px */
            .problem-item.type-div-v { 
                min-height: 230px; 
                align-items: flex-start; 
                padding-top: 50px; 
                padding-bottom: 10px; 
            }
            .problem-text-div { font-family: 'Courier New', monospace; font-weight: bold; font-size: 20pt; margin-left: 5px; }

            .problem-num { font-size: 9pt; color: #666; width: 18px; flex-shrink: 0; margin-top: 6px; }
            .v-row { letter-spacing: 2px; padding-right: 5px; margin-bottom: 5px; }
            .v-bot { border-bottom: 2px solid #000; padding-bottom: 3px; position: relative; padding-left: 25px; min-width: 2.5em; }
            .v-op { position: absolute; left: 2px; bottom: 3px; font-size: 0.7em; }

            .v-div-box { display: flex; align-items: center; }
            .v-div-divisor { margin-right: 6px; font-size: 20pt; }
            .v-div-dividend { border-left: 2px solid #000; border-top: 2px solid #000; padding: 3px 8px; letter-spacing: 2px; font-size: 20pt; }

            .frac { display: inline-block; text-align: center; vertical-align: middle; margin: 0 5px; font-size: 0.9em; line-height: 1.2; }
            .frac-top { border-bottom: 2px solid #000; display: block; padding: 0 5px; }
            .frac-bot { display: block; padding: 0 5px; }

            .answer-page { padding-top: 10px; }
            .answer-header { text-align: center; border-bottom: 2px solid #333; margin-bottom: 20px; padding-bottom: 10px; }
            .answer-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px 10px; }
            .answer-item { font-size: 12pt; padding: 5px; border-bottom: 1px dotted #ddd; display: flex; align-items: center; }
            .answer-text { color: red; font-weight: bold; margin-left: 5px; }
        }
.problem-text-long {
    font-size: 20px;        /* ì¤„ë°”ê¿ˆ ë°©ì§€ìš© ì‘ì€ í°íŠ¸ */
    line-height: 1.1;
    white-space: nowrap;    /* ì¤„ë°”ê¿ˆ ê¸ˆì§€ */
    display: inline-block;
}

/* ê°€ì´ë“œ ì „ì²´ë¥¼ ê°ì‹¸ëŠ” ì¹´ë“œ ë°•ìŠ¤ */
.guide-card {
    max-width: 680px;           /* ì¹´ë“œ ìµœëŒ€ ë„ˆë¹„ */
    margin: 12px auto 18px;     /* ìœ„/ì•„ë˜ ì—¬ë°± + ê°€ë¡œ ê°€ìš´ë° ì •ë ¬ */
    padding: 10px 16px;
    background: #f7f9ff;        /* ì˜…ì€ íŒŒë€ ë°°ê²½ */
    border: 1px solid #dce5ff;
    border-radius: 10px;
    box-sizing: border-box;
}

/* 1, 2, 3 ë‹¨ê³„ ì•ˆë‚´ */
.guide-top {
    margin-bottom: 12px;
    font-size: 13.5px;
    line-height: 1.6;
    font-weight: 600;
    text-align: left;           /* ì¹´ë“œ ì•ˆì—ì„œëŠ” ì™¼ìª½ ì •ë ¬ */
}

.guide-top p {
    display: flex;
    align-items: flex-start;
    gap: 6px;
    margin: 9px 0;
}

/* íŒŒë€ ë²ˆí˜¸ ë°°ì§€ */
.guide-number {
    background: #1976d2;
    color: #fff;
    font-weight: 700;
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 4px;
    min-width: 18px;
    text-align: center;
}

/* ì•„ë˜ìª½ ê·œì¹™ ì„¤ëª… */
.guide-sub {
    margin-top: 4px;
    font-size: 12px;
    color: #555;
    text-align: left;
}



/* ì •ë‹µì§€ í‘¸í„° */
.answer-footer {
    margin-top: 10px;
    padding-top: 6px;
    border-top: 1px solid #ddd;
    text-align: center;
    font-size: 9pt;
    color: #777;
}


.mobile-warning {
    display: none;                 /* ê¸°ë³¸ì€ ìˆ¨ê¹€ (PCì—ì„œëŠ” ì•ˆ ë³´ì´ê²Œ) */
    margin: 8px 0 18px;
    padding: 8px 12px;
    font-size: 12px;
    line-height: 1.5;
    color: #b04a00;
    background: #fff3cd;          /* ì—°í•œ ë…¸ë€ ê²½ê³  ë°•ìŠ¤ ëŠë‚Œ */
    border: 1px solid #ffe49c;
    border-radius: 8px;
    text-align: left;
}

/* í™”ë©´ í­ì´ 768px ì´í•˜(ëŒ€ë¶€ë¶„ ìŠ¤ë§ˆíŠ¸í°)ì¼ ë•Œë§Œ ë³´ì´ê²Œ */
@media (max-width: 768px) {
    .mobile-warning {
        display: block;
    }
    .control-panel {
        padding: 12px;
        width: 100%;
    }
 .tab-btn {
        padding: 8px 15px;
        font-size: 16px;
    }

    #q_count {
        font-size: 14px;
        padding: 6px;
    }

    .generate-btn {
        padding: 10px 16px;
        font-size: 15px;
    }
}

    </style>
</head>
<body>

<div class="control-panel">
    <h1>ğŸ–¨ï¸ ë¬´í•œ ì—°ì‚° ìƒì„±ê¸°</h1>
    <p class="subtitle">ì´ˆë“± 1~3í•™ë…„ ë¬¸ì œ ì œê³µ, í–¥í›„ ì—…ë°ì´íŠ¸ ì˜ˆì •</p>

<!-- âœ… ì—¬ê¸° ì¶”ê°€ -->
    <div class="mobile-warning">
        ğŸ“± í˜„ì¬ ì´ ì‚¬ì´íŠ¸ëŠ” <b>PC ë˜ëŠ” ë…¸íŠ¸ë¶ì—ì„œë§Œ</b> ë¬¸ì œ ìƒì„±ê³¼ ì¸ì‡„ê°€ ì•ˆì •ì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.<br>
        ëª¨ë°”ì¼ì—ì„œëŠ” í™”ë©´ë§Œ ì°¸ê³ í•˜ì‹œê³ , ì‹¤ì œ ì¸ì‡„ëŠ” PCì—ì„œ ë‹¤ì‹œ ì ‘ì†í•´ ì£¼ì„¸ìš”.
    </div>

<div class="guide-card">
  <div class="guide-top">
    <p><span class="guide-number">1</span> í•™ë…„ ì„ íƒ í›„ ì›í•˜ëŠ” ë¬¸ì œ ìœ í˜• ì²´í¬.</p>
    <p><span class="guide-number">2</span> ì¥ ìˆ˜ ì„ íƒ (ê¸°ë³¸ 1ì¥ 20ë¬¸ì œ, ì„¸ë¡œë‚˜ëˆ—ì…ˆ ë³„ë„)</p>
    <p><span class="guide-number">3</span> [ë¬¸ì œì§‘ ë§Œë“¤ê¸°&ì¸ì‡„] ë²„íŠ¼ í´ë¦­ ìë™ ë¬¸ì œ ìƒì„±.</p>
  </div>

  <div class="guide-sub">
    âœ” ê°™ì€ í•™ë…„ì˜ ì—¬ëŸ¬ ë¬¸ì œ ìœ í˜•ì„ í•¨ê»˜ ì„ íƒí•˜ë©´ ë¬¸ì œë“¤ì´ ëœë¤ìœ¼ë¡œ ì„ì—¬ì„œ ì¶œì œ.<br>
    âœ” ì„¸ë¡œ ë‚˜ëˆ—ì…ˆì€ ê³„ì‚° ê³µê°„ ë•Œë¬¸ì— í•œ ì¥ì— 16ë¬¸ì œ(í˜¼í•© ì‹œ 13ë¬¸ì œ)ê¹Œì§€ ì¶œë ¥.
  </div>
</div>


    <input type="text" id="searchInput" class="search-box" placeholder="ğŸ” ê²€ìƒ‰ì–´ ì…ë ¥ (ì˜ˆ: 100, ì„¸ ìˆ˜, ë¹ˆì¹¸, ê³±ì…ˆ)" onkeyup="filterOptions()">

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('grade1')">ì´ˆë“± 1í•™ë…„</button>
        <button class="tab-btn" onclick="openTab('grade2')">ì´ˆë“± 2í•™ë…„</button>
        <button class="tab-btn" onclick="openTab('grade3')">ì´ˆë“± 3í•™ë…„</button>
    </div>

    <div id="grade1" class="options active">
        <details open><summary>1í•™ê¸°: ê¸°ì´ˆ & 2í•™ê¸° ì˜ˆìŠµ</summary>
            <div class="opt-content">
                <div class="checkbox-group">
                    <label><input type="checkbox" name="g1_opt" value="num_9"> ìˆ˜ ê°€ë¥´ê¸°ì™€ ëª¨ìœ¼ê¸°</label>
                    <label><input type="checkbox" name="g1_opt" value="add_sub_9"> ë§ì…ˆê³¼ ëº„ì…ˆ (í•©ì´ 9 ì´í•˜)</label>
                    <label><input type="checkbox" name="g1_opt" value="add_0"> 0ì„ ë”í•˜ê¸°ì™€ ë¹¼ê¸°</label>
                    <label><input type="checkbox" name="g1_opt" value="make_10_add"> 10ì´ ë˜ëŠ” ë”í•˜ê¸° (3 + â–¡ = 10)</label>
                    <label><input type="checkbox" name="g1_opt" value="make_10_sub"> 10ì—ì„œ ë¹¼ê¸° (10 - 7 = â–¡)</label>
                    <label><input type="checkbox" name="g1_opt" value="compare_num"> ìˆ˜ì˜ í¬ê¸° ë¹„êµ (7 â–¡ 9)</label>
                </div>
            </div>
        </details>
        
        <details><summary>2í•™ê¸°: 100ê¹Œì§€ì˜ ìˆ˜ & ì—°ì‚°</summary>
            <div class="opt-content">
                <div class="sub-category">1. ê¸°ë³¸ (ë°›ì•„ì˜¬ë¦¼/ë‚´ë¦¼ ì—†ìŒ)</div>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="g1_opt" value="add_no_carry"> ë‘ ìë¦¬ ìˆ˜ + í•œ ìë¦¬ ìˆ˜</label>
                    <label><input type="checkbox" name="g1_opt" value="sub_no_borrow"> ë‘ ìë¦¬ ìˆ˜ - í•œ ìë¦¬ ìˆ˜</label>
                    <label><input type="checkbox" name="g1_opt" value="v_add_no_carry"><span class="v-label">ì„¸ë¡œ</span> ë‘ ìë¦¬ ìˆ˜ + í•œ ìë¦¬ ìˆ˜</label>
                    <label><input type="checkbox" name="g1_opt" value="v_sub_no_borrow"><span class="v-label">ì„¸ë¡œ</span> ë‘ ìë¦¬ ìˆ˜ - í•œ ìë¦¬ ìˆ˜</label>
                </div>
                <div class="sub-category">2. ì‹¬í™” (ë°›ì•„ì˜¬ë¦¼/ë‚´ë¦¼ ìˆìŒ)</div>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="g1_opt" value="add_11_carry"> í•œ ìë¦¬ ìˆ˜ + í•œ ìë¦¬ ìˆ˜</label>
                    <label><input type="checkbox" name="g1_opt" value="v_add_11_carry"><span class="v-label">ì„¸ë¡œ</span> í•œ ìë¦¬ ìˆ˜ + í•œ ìë¦¬ ìˆ˜ </label>
                    <label><input type="checkbox" name="g1_opt" value="add3_make10"> 10ì„ ë§Œë“¤ì–´ ë”í•˜ê¸° (ì„¸ ìˆ˜)</label> 
                    <label><input type="checkbox" name="g1_opt" value="sub_with_borrow"> ì‹­ëª‡ - ëª‡ (ë°›ì•„ë‚´ë¦¼)</label>
                    <label><input type="checkbox" name="g1_opt" value="v_sub_with_borrow"><span class="v-label">ì„¸ë¡œ</span> ì‹­ëª‡ - ëª‡</label>
                </div>
            </div>
        </details>
    </div>

    <div id="grade2" class="options">
        <details open><summary>1í•™ê¸°: ë‘ ìë¦¬ ìˆ˜ ë§ì…ˆÂ·ëº„ì…ˆ (ì‹¬í™” í¬í•¨)</summary>
            <div class="opt-content">
                <div class="sub-category">1. <span class="v-label">ì„¸ë¡œ</span> ë§ì…ˆÂ·ëº„ì…ˆ</div>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="g2_opt" value="v_add_22_c1"> ë‘ ìë¦¬ ìˆ˜ + ë‘ ìë¦¬ ìˆ˜ (ë°›ì•„ì˜¬ë¦¼ 1ë²ˆ)</label>
                    <label><input type="checkbox" name="g2_opt" value="v_add_22_c2"> ë‘ ìë¦¬ ìˆ˜ + ë‘ ìë¦¬ ìˆ˜ (ë°›ì•„ì˜¬ë¦¼ 2ë²ˆ)</label>
                    <label><input type="checkbox" name="g2_opt" value="v_sub_22_b1"> ë‘ ìë¦¬ ìˆ˜ - ë‘ ìë¦¬ ìˆ˜ (ë°›ì•„ë‚´ë¦¼ 1ë²ˆ)</label>
                    <label><input type="checkbox" name="g2_opt" value="v_sub_from_3digit"> <span class="v-label">ì„¸ë¡œ</span> ì„¸ ìë¦¬ ìˆ˜(100~199) - ë‘ ìë¦¬ ìˆ˜</label>
                </div>

                <div class="sub-category">2. <span class="v-label">ê°€ë¡œ</span> ì„¸ ìˆ˜ì˜ ë§ì…ˆÂ·ëº„ì…ˆ</div>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="g2_opt" value="add_3_nums"> ì„¸ ìˆ˜ì˜ ë§ì…ˆ</label>
                    <label><input type="checkbox" name="g2_opt" value="sub_3_nums"> ì„¸ ìˆ˜ì˜ ëº„ì…ˆ</label>
                    <label><input type="checkbox" name="g2_opt" value="mix_3_nums"> ì„¸ ìˆ˜ì˜ ë§ì…ˆê³¼ ëº„ì…ˆ ì„ì–´ í’€ê¸°</label>
                    <label><input type="checkbox" name="g2_opt" value="start_3digit_calc"> 100ë‹¨ìœ„(100~199)ì—ì„œ ë¹¼ê³  ë”í•˜ê¸°</label>
                </div>

                <div class="sub-category">3. â–¡ êµ¬í•˜ê¸° (ë§ì…ˆê³¼ ëº„ì…ˆì˜ ê´€ê³„)</div>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="g2_opt" value="find_square_add"> â–¡ + (ìˆ˜) = (í•©) / (ìˆ˜) + â–¡ = (í•©)</label>
                    <label><input type="checkbox" name="g2_opt" value="find_square_sub"> (ìˆ˜) - â–¡ = (ì°¨) / â–¡ - (ìˆ˜) = (ì°¨)</label>
                </div>
            </div>
        </details>

        <details><summary>2í•™ê¸°: ê³±ì…ˆêµ¬êµ¬</summary>
            <div class="opt-content">
                <div class="checkbox-group">
                    <label><input type="checkbox" name="g2_opt" value="multi_2_5"> ê³±ì…ˆêµ¬êµ¬ 2~5ë‹¨</label>
                    <label><input type="checkbox" name="g2_opt" value="multi_6_9"> ê³±ì…ˆêµ¬êµ¬ 6~9ë‹¨</label>
                    <label><input type="checkbox" name="g2_opt" value="multi_all"> ê³±ì…ˆêµ¬êµ¬ 2~9ë‹¨ ì„ì–´ì„œ</label>
                    <label><input type="checkbox" name="g2_opt" value="multi_blank"> ê³±ì…ˆêµ¬êµ¬ ë¹ˆì¹¸ ì±„ìš°ê¸°</label>
                    <label><input type="checkbox" name="g2_opt" value="multi_0_1"> 0ë‹¨ê³¼ 1ë‹¨ ì—°ìŠµ</label>
                </div>
            </div>
        </details>
    </div>

    <div id="grade3" class="options">
        <details open><summary>1í•™ê¸°: ë§ì…ˆÂ·ëº„ì…ˆ / ë‚˜ëˆ—ì…ˆ / ê³±ì…ˆ</summary>
            <div class="opt-content">
                <div class="sub-category">1. ë§ì…ˆê³¼ ëº„ì…ˆ</div>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="g3_opt" value="add_33_carry">ì„¸ ìë¦¬ ìˆ˜ + ì„¸ ìë¦¬ ìˆ˜</label>
                    <label><input type="checkbox" name="g3_opt" value="sub_33_borrow">ì„¸ ìë¦¬ ìˆ˜ - ì„¸ ìë¦¬ ìˆ˜</label><br>
                    <label><input type="checkbox" name="g3_opt" value="v_add_3"><span class="v-label">ì„¸ë¡œ</span> ì„¸ ìë¦¬ ìˆ˜ + ì„¸ ìë¦¬ ìˆ˜</label>
                    <label><input type="checkbox" name="g3_opt" value="v_sub_3"><span class="v-label">ì„¸ë¡œ</span> ì„¸ ìë¦¬ ìˆ˜ - ì„¸ ìë¦¬ ìˆ˜</label>
                </div>
                
                <div class="sub-category">2. ë‚˜ëˆ—ì…ˆ (ê¸°ì´ˆ)</div>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="g3_opt" value="div_basic_gugu"> êµ¬êµ¬ë‹¨ìœ¼ë¡œ í’€ë¦¬ëŠ” ë‚˜ëˆ—ì…ˆ</label>
                    <label><input type="checkbox" name="g3_opt" value="div_21_calc"> (ë‘ ìë¦¬) Ã· (í•œ ìë¦¬)</label>
                    <label><input type="checkbox" name="g3_opt" value="v_div_21"><span class="v-label">ì„¸ë¡œ</span> (ë‘ ìë¦¬) Ã· (í•œ ìë¦¬)</label>
                </div>

                <div class="sub-category">3. ê³±ì…ˆ (ê¸°ì´ˆ)</div>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="g3_opt" value="multi_21"> (ë‘ ìë¦¬) Ã— (í•œ ìë¦¬)</label>
                    <label><input type="checkbox" name="g3_opt" value="v_multi_21"><span class="v-label">ì„¸ë¡œ</span> (ë‘ ìë¦¬) Ã— (í•œ ìë¦¬)</label>
                </div>
            </div>
        </details>

        <details><summary>2í•™ê¸°: ê³±ì…ˆ(ì‹¬í™”) / ë‚˜ëˆ—ì…ˆ(ì‹¬í™”) / ë¶„ìˆ˜</summary>
            <div class="opt-content">
                <div class="sub-category">1. ê³±ì…ˆ (í™•ì¥)</div>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="g3_opt" value="multi_22"> (ë‘ ìë¦¬) Ã— (ë‘ ìë¦¬)</label>
                    <label><input type="checkbox" name="g3_opt" value="v_multi_22"><span class="v-label">ì„¸ë¡œ</span> (ë‘ ìë¦¬) Ã— (ë‘ ìë¦¬)</label>
                    <label><input type="checkbox" name="g3_opt" value="multi_31"> (ì„¸ ìë¦¬) Ã— (í•œ ìë¦¬)</label>
                    <label><input type="checkbox" name="g3_opt" value="v_multi_31"><span class="v-label">ì„¸ë¡œ</span> (ì„¸ ìë¦¬) Ã— (í•œ ìë¦¬)</label>
                </div>
                
                <div class="sub-category">2. ë‚˜ëˆ—ì…ˆ (í™•ì¥)</div>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="g3_opt" value="div_21_rem"> (ë‘ ìë¦¬) Ã· (í•œ ìë¦¬) [ë‚˜ë¨¸ì§€O]</label>
                    <label><input type="checkbox" name="g3_opt" value="div_31_no_rem"> (ì„¸ ìë¦¬) Ã· (í•œ ìë¦¬) [ë‚˜ë¨¸ì§€X]</label>
                    <label><input type="checkbox" name="g3_opt" value="div_31_rem"> (ì„¸ ìë¦¬) Ã· (í•œ ìë¦¬) [ë‚˜ë¨¸ì§€O]</label>
<!-- ê¸°ì¡´ ë‚˜ëˆ—ì…ˆ í™•ì¥ 3ê°œ ì•„ë˜ì— ì¶”ê°€ -->

<label>
    <input type="checkbox" name="g3_2_opt" value="v_div2_v">
    <span class="v-label">ì„¸ë¡œ</span> (ë‘ ìë¦¬) Ã· (í•œ ìë¦¬) [ë‚˜ë¨¸ì§€O]
</label>

<label>
    <input type="checkbox" name="g3_2_opt" value="v_div3_no_v">
    <span class="v-label">ì„¸ë¡œ</span> (ì„¸ ìë¦¬) Ã· (í•œ ìë¦¬) [ë‚˜ë¨¸ì§€X]
</label>

<label>
    <input type="checkbox" name="g3_2_opt" value="v_div3_v">
    <span class="v-label">ì„¸ë¡œ</span> (ì„¸ ìë¦¬) Ã· (í•œ ìë¦¬) [ë‚˜ë¨¸ì§€O]
</label>

                </div>

                <div class="sub-category">3. ë¶„ìˆ˜</div>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="g3_opt" value="frac_unit_cmp"> ë‹¨ìœ„ë¶„ìˆ˜ í¬ê¸° ë¹„êµ</label>
                    <label><input type="checkbox" name="g3_opt" value="frac_same_cmp"> ë¶„ëª¨ ê°™ì€ ë¶„ìˆ˜ ë¹„êµ</label>
                </div>
            </div>
        </details>
    </div>

    <div class="bottom-controls">
               <div class="ctrl-group">
            <label for="q_count">ë¬¸ì œ ìˆ˜</label>
<select id="q_count">
  <option value="1">1ì¥</option>
  <option value="2">2ì¥</option>
  <option value="3">3ì¥</option>
  <option value="4">4ì¥</option>
  <option value="5">5ì¥</option>
</select>
        </div>
        <button class="print-btn" onclick="startGeneration()">ë¬¸ì œì§‘ ë§Œë“¤ê¸° & ì¸ì‡„</button>
    </div>
</div>

<div id="print-area"></div>

<script>
    let currentGrade = 'grade1';
    
    function isVerticalDivType(type) { return type.includes('v_div'); }

    function openTab(gradeId) {
        document.querySelectorAll('.options').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(gradeId).classList.add('active');
        event.target.classList.add('active');
        currentGrade = gradeId;
        filterOptions();
    }

    function filterOptions() {
        const keyword = document.getElementById('searchInput').value.toLowerCase();
        const activeGroup = document.getElementById(currentGrade);
        const details = activeGroup.querySelectorAll('details');
        if (keyword) details.forEach(d => d.open = true);
        activeGroup.querySelectorAll('label').forEach(label => {
            label.style.display = label.innerText.toLowerCase().includes(keyword) ? "flex" : "none";
        });
    }

   function rand(min, max) {
        // ë‚œì´ë„ ì—†ì´, ë²”ìœ„ ì•ˆì—ì„œ ê· ì¼í•˜ê²Œ ëœë¤ ìƒì„±
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

// í•œ ìë¦¬ ìˆ«ì(1~9)ì— ëŒ€í•´ ë°›ì¹¨ ìœ ë¬´ íŒë‹¨ìš©
function hasBatchim(num) {
    // í•œììŒ ê¸°ì¤€: 1ì¼, 2ì´, 3ì‚¼, 4ì‚¬, 5ì˜¤, 6ìœ¡, 7ì¹ , 8íŒ”, 9êµ¬
    // ë°›ì¹¨ ìˆëŠ” ê²ƒ: 1(ì¼), 3(ì‚¼), 6(ìœ¡), 7(ì¹ ), 8(íŒ”)
    // ë°›ì¹¨ ì—†ëŠ” ê²ƒ: 2(ì´), 4(ì‚¬), 5(ì˜¤), 9(êµ¬)
    const batchimNums = [1, 3, 6, 7, 8];
    return batchimNums.includes(num);
}

// 'ì€/ëŠ”', 'ê³¼/ì™€' ìë™ ì„ íƒ
function topicParticle(num) {
    return hasBatchim(num) ? 'ì€' : 'ëŠ”';
}
function andParticle(num) {
    return hasBatchim(num) ? 'ê³¼' : 'ì™€';
}


    function fracHTML(top, bot) {
        return `<span class="frac"><span class="frac-top">${top}</span><span class="frac-bot">${bot}</span></span>`;
    }
    
    function createVHTML(n1, n2, op) {
        return `<div class="v-row">${n1}</div><div class="v-row v-bot"><span class="v-op">${op}</span>${n2}</div>`;
    }

    function generateProblem(type) {
        let q, a, isVertical = false, isVerticalDiv = false;
        
        // 1í•™ë…„
       if (type === 'num_9') { 
    let m = rand(2,9), s = rand(1,m-1); 

    const t1 = topicParticle(m);  // ì€/ëŠ”
    const t2 = andParticle(s);    // ê³¼/ì™€

    q = `<span class="problem-text-long">${m}${t1} ${s}${t2} â–¡ë¡œ ê°€ë¥¼ ìˆ˜ ìˆë‹¤.</span>`;
    a = m - s; 
}

        else if (type === 'add_sub_9') { if(Math.random()>0.5){let n1=rand(1,8), n2=rand(1,9-n1); q=`${n1} + ${n2} =`; a=n1+n2;}else{let n1=rand(2,9), n2=rand(1,n1); q=`${n1} - ${n2} =`; a=n1-n2;} }
        else if (type === 'add_0') { let n=rand(1,9); q=`${n} + 0 =`; a=n; }
        else if (type === 'make_10_add') { let n=rand(1,9), c=10-n; if(Math.random()>0.5){q=`${n} + â–¡ = 10`; a=c;}else{q=`â–¡ + ${n} = 10`; a=c;} }
        else if (type === 'make_10_sub') { let n=rand(1,9), c=10-n; if(Math.random()>0.5){q=`10 - ${n} = â–¡`; a=c;}else{q=`10 - â–¡ = ${n}`; a=c;} }
        else if (type === 'compare_num') { let n1=rand(1,99), n2=rand(1,99); while(n1===n2)n2=rand(1,99); q=`${n1} â–¡ ${n2}`; a=(n1>n2)?'>':'<'; }
        else if (type === 'add_no_carry') { let t1=rand(1,9), u1=rand(0,8), n1=t1*10+u1, n2=rand(1,9-u1); q=`${n1} + ${n2} =`; a=n1+n2; }
        else if (type === 'sub_no_borrow') { let t1=rand(1,9), u1=rand(1,9), n2=rand(1,u1), n1=t1*10+u1; q=`${n1} - ${n2} =`; a=n1-n2; }
        else if (type === 'v_add_no_carry') { isVertical=true; let t1=rand(1,9), u1=rand(0,8), n1=t1*10+u1, n2=rand(1,9-u1); q=createVHTML(n1,n2,'+'); a=n1+n2; }
        else if (type === 'v_sub_no_borrow') { isVertical=true; let t1=rand(2,9), u1=rand(1,9), n2=rand(1,u1), n1=t1*10+u1; q=createVHTML(n1,n2,'-'); a=n1-n2; }
        else if (type === 'add_11_carry') { let n1,n2; do{n1=rand(1,9);n2=rand(1,9);}while(n1+n2<10); q=`${n1} + ${n2} =`; a=n1+n2; }
        else if (type === 'v_add_11_carry') { isVertical=true; let n1,n2; do{n1=rand(1,9);n2=rand(1,9);}while(n1+n2<10); q=createVHTML(n1,n2,'+'); a=n1+n2; }
        else if (type === 'add3_make10') { let p=rand(1,9), c=10-p, e=rand(1,9), arr=[p,c,e].sort(()=>Math.random()-0.5); q=`${arr[0]} + ${arr[1]} + ${arr[2]} =`; a=10+e; }
        else if (type === 'sub_with_borrow') { let t1=1, u1=rand(0,8), n2=rand(u1+1,9), n1=t1*10+u1; q=`${n1} - ${n2} =`; a=n1-n2; }
        else if (type === 'v_sub_with_borrow') { isVertical=true; let t1=1, u1=rand(0,8), n2=rand(u1+1,9), n1=t1*10+u1; q=createVHTML(n1,n2,'-'); a=n1-n2; }

        // 2í•™ë…„
        else if (type === 'v_add_22_c1') { isVertical=true; let u1=rand(1,9), u2=rand(10-u1,9), t1=rand(1,7), t2=rand(1,8-t1); q=createVHTML(t1*10+u1,t2*10+u2,'+'); a=(t1*10+u1)+(t2*10+u2); }
        else if (type === 'v_add_22_c2') { isVertical=true; let u1=rand(1,9), u2=rand(10-u1,9), t1=rand(1,9), t2=rand(Math.max(1,9-t1),9); q=createVHTML(t1*10+u1,t2*10+u2,'+'); a=(t1*10+u1)+(t2*10+u2); }
        else if (type === 'v_sub_22_b1') { isVertical=true; let t1=rand(2,9), u1=rand(0,8), n1=t1*10+u1, u2=rand(u1+1,9), t2=rand(1,t1-1); q=createVHTML(n1,t2*10+u2,'-'); a=n1-(t2*10+u2); }
        else if (type === 'v_sub_from_3digit') { isVertical=true; let n1=rand(100,199), n2=rand(10,99); while(n1<=n2){n1=rand(100,199);n2=rand(10,99);} q=createVHTML(n1,n2,'-'); a=n1-n2; }
        else if (type === 'add_3_nums') { let x=rand(10,50), y=rand(10,30), z=rand(1,9); q=`${x} + ${y} + ${z} =`; a=x+y+z; }
        else if (type === 'sub_3_nums') { let x=rand(30,90), y=rand(5,15), z=rand(1,9); q=`${x} - ${y} - ${z} =`; a=x-y-z; }
        else if (type === 'mix_3_nums') { if(Math.random()>0.5){let x=rand(10,50), y=rand(10,30), z=rand(5,15); q=`${x} + ${y} - ${z} =`; a=x+y-z;}else{let x=rand(30,80), y=rand(5,20), z=rand(5,20); q=`${x} - ${y} + ${z} =`; a=x-y+z;} }
        else if (type === 'start_3digit_calc') { let n1=rand(100,199), n2=rand(10,60), n3=rand(5,50); if(Math.random()>0.5){while(n1-n2-n3<0){n1=rand(100,199);n2=rand(10,40);n3=rand(5,30);} q=`${n1} - ${n2} - ${n3} =`; a=n1-n2-n3;}else{while(n1-n2<0){n1=rand(100,199);n2=rand(10,80);} q=`${n1} - ${n2} + ${n3} =`; a=n1-n2+n3;} }
        else if (type === 'find_square_add') { let n1=rand(10,50), n2=rand(10,49), s=n1+n2; if(Math.random()>0.5){q=`${n1} + â–¡ = ${s}`; a=n2;}else{q=`â–¡ + ${n2} = ${s}`; a=n1;} }
        else if (type === 'find_square_sub') { let n1=rand(20,99), n2=rand(1,n1-10), d=n1-n2; if(Math.random()>0.5){q=`${n1} - â–¡ = ${d}`; a=n2;}else{q=`â–¡ - ${n2} = ${d}`; a=n1;} }
        else if (type === 'multi_2_5') { let n1=rand(2,5), n2=rand(1,9); q=`${n1} Ã— ${n2} =`; a=n1*n2; }
        else if (type === 'multi_6_9') { let n1=rand(6,9), n2=rand(1,9); q=`${n1} Ã— ${n2} =`; a=n1*n2; }
        else if (type === 'multi_all') { let n1=rand(2,9), n2=rand(1,9); q=`${n1} Ã— ${n2} =`; a=n1*n2; }
        else if (type === 'multi_blank') { let n1=rand(2,9), n2=rand(2,9), p=n1*n2; if(Math.random()>0.5){q=`${n1} Ã— â–¡ = ${p}`; a=n2;}else{q=`â–¡ Ã— ${n2} = ${p}`; a=n1;} }
        else if (type === 'multi_0_1') { let n1=rand(0,1), n2=rand(1,9); if(Math.random()>0.5){q=`${n1} Ã— ${n2} =`; a=n1*n2;}else{q=`${n2} Ã— ${n1} =`; a=n2*n1;} }

        // 3í•™ë…„
        else if (type === 'add_33_carry') { let n1=rand(150,850), n2=rand(150,850); q=`${n1} + ${n2} =`; a=n1+n2; }
        else if (type === 'sub_33_borrow') { let n1=rand(300,999), n2=rand(150,n1-50); q=`${n1} - ${n2} =`; a=n1-n2; }
        else if (type === 'v_add_3') { isVertical=true; let n1=rand(150,850), n2=rand(150,850); q=createVHTML(n1,n2,'+'); a=n1+n2; }
        else if (type === 'v_sub_3') { isVertical=true; let n1=rand(300,999), n2=rand(150,n1-50); q=createVHTML(n1,n2,'-'); a=n1-n2; }
        else if (type === 'div_basic_gugu') { let d=rand(2,9), qv=rand(1,9), n=d*qv; q=`${n} Ã· ${d} =`; a=qv; }
        else if (type === 'div_21_calc') { let d,qv,n; while(true){d=rand(2,9);qv=rand(2,9);n=d*qv;if(n>=10&&n<=99)break;} q=`${n} Ã· ${d} =`; a=qv; }
        else if (type === 'v_div_21') { isVerticalDiv=true; let d,qv,n; while(true){d=rand(2,9);qv=rand(2,9);n=d*qv;if(n>=10&&n<=99)break;} q=`<div class="v-div-box"><span class="v-div-divisor">${d}</span><span class="v-div-dividend">${n}</span></div>`; a=qv; }
        else if (type === 'multi_21') { let n1=rand(10,99), n2=rand(2,9); q=`${n1} Ã— ${n2} =`; a=n1*n2; }
        else if (type === 'v_multi_21') { isVertical=true; let n1=rand(10,99), n2=rand(2,9); q=createVHTML(n1,n2,'Ã—'); a=n1*n2; }
        else if (type === 'multi_22') { let n1=rand(10,99), n2=rand(10,99); q=`${n1} Ã— ${n2} =`; a=n1*n2; }
        else if (type === 'v_multi_22') { isVertical=true; let n1=rand(10,99), n2=rand(10,99); q=createVHTML(n1,n2,'Ã—'); a=n1*n2; }
        else if (type === 'div_21_rem') { let d,r,qv,n; while(true){d=rand(2,9);r=rand(1,d-1);let max=Math.floor((99-r)/d);if(max<2)continue;qv=rand(2,max);n=d*qv+r;if(n>=10&&n<=99)break;} q=`${n} Ã· ${d} =`; a=`${qv}...${r}`; }
        else if (type === 'div_31_no_rem') { let d=rand(2,9), min=Math.ceil(100/d), max=Math.floor(999/d); if(min<10)min=10; if(max<min){min=2;max=Math.floor(999/d);} let qv=rand(min,max), n=d*qv; while(n<100||n>999){d=rand(2,9);min=Math.ceil(100/d);max=Math.floor(999/d);if(min<10)min=10;if(max<min){min=2;max=Math.floor(999/d);}qv=rand(min,max);n=d*qv;} q=`${n} Ã· ${d} =`; a=qv; }
        else if (type === 'div_31_rem') { let d,r,qv,n; while(true){d=rand(2,9);r=rand(1,d-1);let min=Math.ceil(100/d), max=Math.floor((999-r)/d);if(min<10)min=10;if(max<min)continue;qv=rand(min,max);n=d*qv+r;if(n>=100&&n<=999)break;} q=`${n} Ã· ${d} =`; a=`${qv}...${r}`; }
        // 3í•™ë…„ 2í•™ê¸°: ì„¸ë¡œ ë‚˜ëˆ—ì…ˆ (í™•ì¥)

        // (ë‘ ìë¦¬) Ã· (í•œ ìë¦¬) [ë‚˜ë¨¸ì§€O]  ì„¸ë¡œ
        else if (type === 'v_div2_v') {
            isVerticalDiv = true;
            let d, r, qv, n;
            while (true) {
                d = rand(2, 9);              // ë‚˜ëˆ„ëŠ” ìˆ˜
                r = rand(1, d - 1);          // ë‚˜ë¨¸ì§€ (0 ì•„ë‹˜)
                const max = Math.floor((99 - r) / d);
                if (max < 2) continue;       // ëª«ì´ ìµœì†Œ 2 ì´ìƒ ë˜ë„ë¡
                qv = rand(2, max);           // ëª«
                n = d * qv + r;              // í”¼ì œìˆ˜
                if (n >= 10 && n <= 99) break;
            }
            q = `<div class="v-div-box"><span class="v-div-divisor">${d}</span><span class="v-div-dividend">${n}</span></div>`;
            a = `${qv}...${r}`;
        }

        // (ì„¸ ìë¦¬) Ã· (í•œ ìë¦¬) [ë‚˜ë¨¸ì§€X]  ì„¸ë¡œ
        else if (type === 'v_div3_no_v') {
            isVerticalDiv = true;
            let d, n, qv;
            while (true) {
                d = rand(2, 9);
                let min = Math.ceil(100 / d);
                let max = Math.floor(999 / d);
                if (min < 10) min = 10;
                if (max < min) {             // í˜¹ì‹œ ë²”ìœ„ ê¼¬ì´ë©´ ë‹¤ì‹œ
                    min = 2;
                    max = Math.floor(999 / d);
                }
                qv = rand(min, max);
                n = d * qv;
                if (n >= 100 && n <= 999) break;
            }
            q = `<div class="v-div-box"><span class="v-div-divisor">${d}</span><span class="v-div-dividend">${n}</span></div>`;
            a = qv;
        }

        // (ì„¸ ìë¦¬) Ã· (í•œ ìë¦¬) [ë‚˜ë¨¸ì§€O]  ì„¸ë¡œ
        else if (type === 'v_div3_v') {
            isVerticalDiv = true;
            let d, r, qv, n;
            while (true) {
                d = rand(2, 9);
                r = rand(1, d - 1);
                let min = Math.ceil(100 / d);
                let max = Math.floor((999 - r) / d);
                if (min < 10) min = 10;
                if (max < min) continue;     // ìœ íš¨í•œ ëª« ë²”ìœ„ê°€ ì—†ìœ¼ë©´ ë‹¤ì‹œ
                qv = rand(min, max);
                n = d * qv + r;
                if (n >= 100 && n <= 999) break;
            }
            q = `<div class="v-div-box"><span class="v-div-divisor">${d}</span><span class="v-div-dividend">${n}</span></div>`;
            a = `${qv}...${r}`;
        }

        else if (type === 'frac_unit_cmp') { let m1=rand(2,12), m2=rand(2,12); while(m1===m2)m2=rand(2,12); q=`${fracHTML(1,m1)} â–¡ ${fracHTML(1,m2)}`; a=(m1<m2)?'>':'<'; }
        else if (type === 'frac_same_cmp') { let m=rand(3,15), j1=rand(1,m-1), j2=rand(1,m-1); while(j1===j2)j2=rand(1,m-1); q=`${fracHTML(j1,m)} â–¡ ${fracHTML(j2,m)}`; a=(j1>j2)?'>':'<'; }
        else if (type === 'multi_31') { let n1=rand(100,999), n2=rand(2,9); q=`${n1} Ã— ${n2} =`; a=n1*n2; }
        else if (type === 'v_multi_31') { isVertical=true; let n1=rand(100,999), n2=rand(2,9); q=createVHTML(n1,n2,'Ã—'); a=n1*n2; }
        else { q="1 + 1 ="; a=2; }

        if (isVerticalDivType(type)) isVerticalDiv = true;

        return {q: q, a: a, isVertical: isVertical, isVerticalDiv: isVerticalDiv};
    }

    // [V46 í•µì‹¬] í•­ëª©ë³„ ê· ë“± ë°°ë¶„(Round-Robin) ë¦¬ìŠ¤íŠ¸ ìƒì„± í•¨ìˆ˜
    function getBalancedTypes(selectedTypes, totalCount) {
        if (selectedTypes.length === 0) return [];
        
        let balancedList = [];
        let typeIndex = 0;
        
        for (let i = 0; i < totalCount; i++) {
            balancedList.push(selectedTypes[typeIndex]);
            typeIndex = (typeIndex + 1) % selectedTypes.length; // ìˆœí™˜
        }
        return balancedList;
    }

    // [V45] í˜ì´ì§€ êµ¬ì„± ë¡œì§ (ìœ í˜•ë³„ ë¶„ë¦¬ + V46 ê· ë“±ë°°ë¶„)
// [V46] í˜ì´ì§€ êµ¬ì„± ë¡œì§ (ì¥ ìˆ˜ ê¸°ì¤€ + ì„¸ë¡œ ë‚˜ëˆ—ì…ˆ ì‹œ ì¥ë‹¹ 12ë¬¸ì œ)
function startGeneration() {
    const checkboxes = document.querySelectorAll(
        `#${currentGrade} input[type="checkbox"]:checked`
    );
    if (checkboxes.length === 0) {
        alert("ë¬¸ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");
        return;
    }

    const types = Array.from(checkboxes).map(cb => cb.value);

    // âœ… ë“œë¡­ë‹¤ìš´ ê°’ = "ì¶œë ¥í•  ì¥ ìˆ˜"
    const pagesRequested = parseInt(
        document.getElementById("q_count").value,
        10
    );

    const printArea = document.getElementById("print-area");
    printArea.innerHTML = "";

    const today = new Date();
    const dateStr = `${today.getFullYear()}. ${
        today.getMonth() + 1
    }. ${today.getDate()}`;

    // â”€â”€ ì„¸ë¡œ ë‚˜ëˆ—ì…ˆ í¬í•¨ ì—¬ë¶€ íŒë‹¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const hasVDiv = types.some(t => isVerticalDivType(t));
    const onlyVDiv = hasVDiv && types.every(t => isVerticalDivType(t));

    // ğŸ”¹ ì¥ë‹¹ ë¬¸ì œ ìˆ˜ ê²°ì •
    let problemsPerPage;
    if (onlyVDiv) {
        // ì„¸ë¡œ ë‚˜ëˆ—ì…ˆë§Œ ìˆëŠ” ê²½ìš°: 16ë¬¸ì œ
        problemsPerPage = 16;
    } else if (hasVDiv) {
        // ì„¸ë¡œ ë‚˜ëˆ—ì…ˆ + ë‹¤ë¥¸ ìœ í˜• ì„ì¸ ê²½ìš°: 13ë¬¸ì œ
        problemsPerPage = 13;
    } else {
        // ì„¸ë¡œ ë‚˜ëˆ—ì…ˆì´ ì „í˜€ ì—†ëŠ” ê²½ìš°: 20ë¬¸ì œ
        problemsPerPage = 20;
    }

    // âœ… ì‹¤ì œ ìƒì„±í•  ì´ ë¬¸ì œ ìˆ˜ = ì¥ ìˆ˜ Ã— ì¥ë‹¹ ë¬¸ì œ ìˆ˜
    const targetTotalCount = pagesRequested * problemsPerPage;

    let allGeneratedProblems = [];
    let totalGenerated = 0;
    let pageNum = 1;
    let globalTypeIndex = 0; // ì—¬ëŸ¬ íƒ€ì… ê³¨ê³ ë£¨ ì„ê¸°ìš© ì¸ë±ìŠ¤

    while (pageNum <= pagesRequested && totalGenerated < targetTotalCount) {
        // ì´ë²ˆ í˜ì´ì§€ì— ë“¤ì–´ê°ˆ ë¬¸ì œ ê°œìˆ˜(ë§ˆì§€ë§‰ ì¥ì—ì„œ í˜¹ì‹œ ëª¨ìë¼ë©´ ì¡°ì •)
        const remaining = targetTotalCount - totalGenerated;
        const currentBatchSize = Math.min(problemsPerPage, remaining);

        // ì´ë²ˆ í˜ì´ì§€ìš© ë¬¸ì œ ìƒì„±
        let batchProblems = [];
        for (let i = 0; i < currentBatchSize; i++) {
            const t = types[globalTypeIndex % types.length];
            globalTypeIndex++;
            batchProblems.push(generateProblem(t));
        }

        // ìœ í˜•ë³„ ë¶„ë¦¬
        let groupDivs = batchProblems.filter(p => p.isVerticalDiv);
        let groupVerticals = batchProblems.filter(
            p => p.isVertical && !p.isVerticalDiv
        );
        let groupHorizontals = batchProblems.filter(
            p => !p.isVertical && !p.isVerticalDiv
        );

        // ì¶œë ¥ ìˆœì„œ: ì„¸ë¡œ ë‚˜ëˆ—ì…ˆ â†’ ì„¸ë¡œì…ˆ â†’ ê°€ë¡œì…ˆ
        let printOrder = [
            ...groupDivs,
            ...groupVerticals,
            ...groupHorizontals,
        ];

        // ì „ì²´ ë²ˆí˜¸ ë¶€ì—¬
        printOrder.forEach((p, idx) => {
            p.num = totalGenerated + idx + 1;
        });

        // í˜ì´ì§€ DOM
        const pageDiv = document.createElement("div");
        pageDiv.className = "page";

        let contentHtml = "";

        // 1. ì„¸ë¡œ ë‚˜ëˆ—ì…ˆ (4ì—´)
        if (groupDivs.length > 0) {
            contentHtml += '<div class="section-grid-4">';
            groupDivs.forEach(p => {
                contentHtml += `
                    <div class="problem-item type-div-v">
                        <span class="problem-num">${p.num}.</span>
                        <div class="problem-text-div">${p.q}</div>
                    </div>`;
            });
            contentHtml += "</div>";
        }

        // 2. ì„¸ë¡œì…ˆ (4ì—´)
        if (groupVerticals.length > 0) {
            contentHtml += '<div class="section-grid-4">';
            groupVerticals.forEach(p => {
                contentHtml += `
                    <div class="problem-item type-v">
                        <span class="problem-num">${p.num}.</span>
                        <div class="problem-text-v">${p.q}</div>
                    </div>`;
            });
            contentHtml += "</div>";
        }

        // 3. ê°€ë¡œì…ˆ (2ì—´)
        if (groupHorizontals.length > 0) {
            contentHtml += '<div class="section-grid-2">';
            groupHorizontals.forEach(p => {
                contentHtml += `
                    <div class="problem-item type-h">
                        <span class="problem-num">${p.num}.</span>
                        <div class="problem-text-h">${p.q}</div>
                    </div>`;
            });
            contentHtml += "</div>";
        }

        const startNum = printOrder[0].num;
        const endNum = printOrder[printOrder.length - 1].num;

        let headerHtml =
            pageNum === 1
                ? `<div class="paper-header">
                        <div class="paper-title">ìˆ˜í•™ ì—°ì‚°ë ¥ ê°•í™” í›ˆë ¨</div>
                        <div class="paper-info">
                            <span>ë‚ ì§œ: ${dateStr}</span>
                            <span>ì´ë¦„: ____________</span>
                            <span>(${startNum}~${endNum}ë²ˆ)</span>
                        </div>
                   </div>`
                : `<div class="simple-header">
                        <span>${dateStr} ì—°ì‚° ì—°ìŠµ (${startNum}~${endNum}ë²ˆ)</span>
                   </div>`;

        pageDiv.innerHTML = headerHtml + contentHtml;
        printArea.appendChild(pageDiv);

        allGeneratedProblems.push(...printOrder);
        totalGenerated += currentBatchSize;
        pageNum++;
    }

    // â”€â”€ ì •ë‹µì§€ ìƒì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const ansPerPage = 100;
    for (let i = 0; i < allGeneratedProblems.length; i += ansPerPage) {
        const chunk = allGeneratedProblems.slice(i, i + ansPerPage);
        const ansPage = document.createElement("div");
        ansPage.className = "page answer-page";

        let gridHtml = "";
        chunk.forEach(p => {
            gridHtml += `<div class="answer-item">
                            <span class="problem-num">${p.num}.</span>
                            <span class="answer-text">${p.a}</span>
                         </div>`;
        });

        const startNum = chunk[0].num;
        const endNum = chunk[chunk.length - 1].num;

        ansPage.innerHTML = `
            <div class="answer-header">
                <div class="paper-title" style="font-size:18pt; margin-bottom: 5px;">[ ì • ë‹µ ì§€ ]</div>
                <div style="font-size:11pt; color:#555;">
                    <span>ì—„ë§ˆí‘œ ë¹ ë¥¸ ì±„ì  â¤ï¸ (${startNum}~${endNum}ë²ˆ)</span>
                </div>
            </div>
            <div class="answer-grid">
                ${gridHtml}
            </div>
            <div class="answer-footer">
                @think.blank.lab Â· ì •ë‹µ ì˜¤ë¥˜ë‚˜ ê°œì„  ì œì•ˆì´ ìˆë‹¤ë©´ ì¸ìŠ¤íƒ€ DMìœ¼ë¡œ í¸í•˜ê²Œ ì•Œë ¤ì£¼ì„¸ìš” :)
            </div>`;
        printArea.appendChild(ansPage);
    }

    setTimeout(() => window.print(), 500);
}

</script>
</body>
</html>





